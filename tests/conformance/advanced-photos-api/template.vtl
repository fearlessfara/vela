#set($inputRoot = $input.path('$'))
#set($requestId = $context.requestId)
#set($timestamp = $util.time.nowISO8601())
#set($userAgent = $context.identity.userAgent)
#set($sourceIp = $context.identity.sourceIp)

{
  "requestMetadata": {
    "requestId": "$requestId",
    "timestamp": "$timestamp",
    "userAgent": "$userAgent",
    "sourceIp": "$sourceIp",
    "apiStage": "$context.stage",
    "httpMethod": "$context.httpMethod"
  },
  "photos": [
#foreach($elem in $inputRoot.photos.photo)
    {
      "id": "$elem.id",
      "photographedBy": "$elem.photographer_first_name $elem.photographer_last_name",
      "title": "$util.escapeJavaScript($elem.title)",
      "ispublic": $elem.ispublic,
      "isfriend": $elem.isfriend,
      "isfamily": $elem.isfamily,
      "photoUrl": "https://farm$elem.farm.staticflickr.com/$elem.server/$elem.id_$elem.secret.jpg",
      "owner": "$elem.owner",
      "processedAt": "$timestamp"
    }#if($foreach.hasNext),#end
		
#end
  ],
  "pagination": {
    "currentPage": $inputRoot.photos.page,
    "totalPages": $inputRoot.photos.pages,
    "perPage": $inputRoot.photos.perpage,
    "totalPhotos": $inputRoot.photos.total
  },
  "responseMetadata": {
    "processedCount": $inputRoot.photos.photo.size(),
    "apiVersion": "$context.stageVariables.apiVersion",
    "requestTime": "$context.requestTime"
  }
}
